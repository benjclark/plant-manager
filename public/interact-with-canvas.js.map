{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/draw-on-canvas.js","src/interact-with-canvas.js","src/mouse-event-handlers.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"interact-with-canvas.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","function clearCanvas() {\n    const canvas = document.querySelector('canvas');\n    const canvasContext = canvas.getContext('2d');\n    canvasContext.clearRect(0, 0, canvas.width, canvas.height);\n}\n\nfunction drawBed(x, y, w, h) {\n    const canvasContext = document.querySelector('canvas').getContext('2d');\n    canvasContext.beginPath();\n    canvasContext.rect(x, y, w, h);\n    canvasContext.closePath();\n    canvasContext.fill();\n}\n\nfunction drawPlant(x, y, w, h, fileName) {\n    const canvas = document.querySelector('canvas');\n    const ctx = canvas.getContext('2d');\n    const image = new Image();\n    image.src = `/${fileName}`;\n    image.onload = () => {\n        ctx.drawImage(image, x, y, w, h);\n    };\n}\n\nfunction drawAll() {\n    const pm = window.plantManager;\n    const canvas = document.querySelector('canvas');\n    const canvasContext = canvas.getContext('2d');\n    clearCanvas();\n    canvasContext.fillStyle = \"#af865d3d\";\n    drawBed(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < pm.beds.length; i++) {\n        const b = pm.beds[i];\n        canvasContext.fillStyle = b.fill;\n        drawBed(b.x, b.y, b.width, b.height);\n    }\n    for (let i = 0; i < pm.plants.length; i++) {\n        const p = pm.plants[i];\n        drawPlant(p.x, p.y, p.width, p.height, p.imageFileName);\n    }\n}\n\nmodule.exports = {\n    clearCanvas,\n    drawBed,\n    drawAll\n};\n","const mouseEventHandlers = require('./mouse-event-handlers');\nconst drawOnCanvas = require('./draw-on-canvas');\n\nconst canvas = document.querySelector('canvas');\nconst canvasContext = canvas.getContext('2d');\n\nfunction renderEditFormForCurrentlySelectedBed() {\n    const currentSelected = window.plantManager.mouseEventVariables.currentRectSelected;\n    if (!currentSelected) {\n        return;\n    }\n\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = currentSelected.name;\n    const width = currentSelected.width;\n    const height = currentSelected.height;\n    const fill = currentSelected.fill;\n    const soilCharacteristics = currentSelected.soil_characteristics;\n    const type = currentSelected.bed_type;\n\n    updateBedForm.querySelector('[data-bed-name]').value = name;\n    updateBedForm.querySelector('[data-bed-width]').value = width;\n    updateBedForm.querySelector('[data-bed-height]').value = height;\n    updateBedForm.querySelector('[data-bed-colour]').value = fill;\n    updateBedForm.querySelector('[data-bed-soil-characteristics]').value = soilCharacteristics;\n    updateBedForm.querySelector('[data-bed-type]').value = type;\n}\n\nwindow.plantManager = {\n    canvasOffsetX: canvas.getBoundingClientRect().left,\n    canvasOffsetY: canvas.getBoundingClientRect().top,\n    beds: [],\n    plants: [],\n    renderEditFormForCurrentlySelectedBed: renderEditFormForCurrentlySelectedBed\n};\nconst pm = window.plantManager;\n\ncanvasContext.fillStyle = \"#af865d3d\";\ncanvasContext.fillRect(0,0, canvas.width, canvas.height);\n\nmouseEventHandlers.setupMouseEventVariables();\ncanvas.onmousedown = mouseEventHandlers.mouseDownHandler;\ncanvas.onmouseup = mouseEventHandlers.mouseUpHandler;\ncanvas.onmousemove = mouseEventHandlers.mouseMoveHandler;\n\ndrawOnCanvas.drawAll();\npm.drawAll = drawOnCanvas.drawAll;\n","const drawOnCanvas = require('./draw-on-canvas');\n\nfunction mouseUpHandler(e) {\n    const pm = window.plantManager;\n    const mouseEventVars = pm.mouseEventVariables;\n    e.preventDefault();\n    e.stopPropagation();\n\n    // clear all the dragging flags\n    mouseEventVars.somethingIsBeingDragged = false;\n\n    for (let z = 0; z < pm.beds.length; z++) {\n        pm.beds[z].isDragging = false;\n    }\n    for (let z = 0; z < pm.plants.length; z++) {\n        pm.plants[z].isDragging = false;\n    }\n}\n\nfunction mouseDownHandler(e) {\n    const pm = window.plantManager;\n    const mouseEventVars = pm.mouseEventVariables;\n    e.preventDefault();\n    e.stopPropagation();\n\n    // get the current mouse position\n    const mx = parseInt(e.clientX - pm.canvasOffsetX);\n    const my = parseInt(e.clientY - pm.canvasOffsetY);\n\n    // clear all the dragging flags\n    mouseEventVars.somethingIsBeingDragged = false;\n\n    // test each rect to see if mouse is inside\n    for (let i = (pm.beds.length - 1); i >= 0; i--) {\n        const b = pm.beds[i];\n        if (mx > parseInt(b.x, 10) && mx < parseInt(b.x, 10) + parseInt(b.width, 10) && my > parseInt(b.y, 10) && my < parseInt(b.y, 10) + parseInt(b.height, 10)) {\n            // if yes, set that rects isDragging=true\n            mouseEventVars.somethingIsBeingDragged = true;\n            mouseEventVars.currentRectSelected = b;\n            b.isDragging = true;\n            pm.renderEditFormForCurrentlySelectedBed();\n            break;\n        }\n    }\n    for (let i = (pm.plants.length - 1); i >= 0; i--) {\n        const p = pm.plants[i];\n        if (mx > parseInt(p.x, 10) && mx < parseInt(p.x, 10) + parseInt(p.width, 10) && my > parseInt(p.y, 10) && my < parseInt(p.y, 10) + parseInt(p.height, 10)) {\n            // if yes, set that rects isDragging=true\n            mouseEventVars.somethingIsBeingDragged = true;\n            mouseEventVars.currentRectSelected = p;\n            p.isDragging = true;\n            // pm.renderEditFormForCurrentlySelectedPlant();   <--- TODO\n            break;\n        }\n    }\n    // save the current mouse position\n    mouseEventVars.startX = mx;\n    mouseEventVars.startY = my;\n}\n\nfunction mouseMoveHandler(e) {\n    const pm = window.plantManager;\n    const mouseEventVars = pm.mouseEventVariables;\n    // if we're dragging anything...\n    if (mouseEventVars.somethingIsBeingDragged) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        // get the current mouse position\n        const mx = parseInt(e.clientX - pm.canvasOffsetX);\n        const my = parseInt(e.clientY - pm.canvasOffsetY);\n\n        // calculate the distance the mouse has moved\n        // since the last mousemove\n        const dx = mx - mouseEventVars.startX;\n        const dy = my - mouseEventVars.startY;\n\n        // move each rect that isDragging\n        // by the distance the mouse has moved\n        // since the last mousemove\n        for (let i = 0; i < pm.beds.length; i++) {\n            const b = pm.beds[i];\n            if (b.isDragging) {\n                b.x += dx;\n                b.y += dy;\n            }\n        }\n\n        for (let i = 0; i < pm.plants.length; i++) {\n            const p = pm.plants[i];\n            if (p.isDragging) {\n                p.x += dx;\n                p.y += dy;\n            }\n        }\n\n        // redraw the scene with the new rect positions\n        drawOnCanvas.drawAll();\n\n        // reset the starting mouse position for the next mousemove\n        mouseEventVars.startX = mx;\n        mouseEventVars.startY = my;\n    }\n}\n\nfunction setupMouseEventVariables() {\n    const pm = window.plantManager;\n    const mouseEventVars = pm.mouseEventVariables = {};\n    mouseEventVars.somethingIsBeingDragged = false;\n    mouseEventVars.currentRectSelected = undefined;\n    mouseEventVars.startX = undefined;\n    mouseEventVars.startY = undefined;\n}\n\nmodule.exports = {\n    mouseUpHandler,\n    mouseDownHandler,\n    mouseMoveHandler,\n    setupMouseEventVariables\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvZHJhdy1vbi1jYW52YXMuanMiLCJzcmMvaW50ZXJhY3Qtd2l0aC1jYW52YXMuanMiLCJzcmMvbW91c2UtZXZlbnQtaGFuZGxlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJmdW5jdGlvbiBjbGVhckNhbnZhcygpIHtcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcbiAgICBjb25zdCBjYW52YXNDb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY2FudmFzQ29udGV4dC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbn1cblxuZnVuY3Rpb24gZHJhd0JlZCh4LCB5LCB3LCBoKSB7XG4gICAgY29uc3QgY2FudmFzQ29udGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7XG4gICAgY2FudmFzQ29udGV4dC5iZWdpblBhdGgoKTtcbiAgICBjYW52YXNDb250ZXh0LnJlY3QoeCwgeSwgdywgaCk7XG4gICAgY2FudmFzQ29udGV4dC5jbG9zZVBhdGgoKTtcbiAgICBjYW52YXNDb250ZXh0LmZpbGwoKTtcbn1cblxuZnVuY3Rpb24gZHJhd1BsYW50KHgsIHksIHcsIGgsIGZpbGVOYW1lKSB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FudmFzJyk7XG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWFnZS5zcmMgPSBgLyR7ZmlsZU5hbWV9YDtcbiAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIHgsIHksIHcsIGgpO1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIGRyYXdBbGwoKSB7XG4gICAgY29uc3QgcG0gPSB3aW5kb3cucGxhbnRNYW5hZ2VyO1xuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xuICAgIGNvbnN0IGNhbnZhc0NvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjbGVhckNhbnZhcygpO1xuICAgIGNhbnZhc0NvbnRleHQuZmlsbFN0eWxlID0gXCIjYWY4NjVkM2RcIjtcbiAgICBkcmF3QmVkKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbS5iZWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGIgPSBwbS5iZWRzW2ldO1xuICAgICAgICBjYW52YXNDb250ZXh0LmZpbGxTdHlsZSA9IGIuZmlsbDtcbiAgICAgICAgZHJhd0JlZChiLngsIGIueSwgYi53aWR0aCwgYi5oZWlnaHQpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBtLnBsYW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBwID0gcG0ucGxhbnRzW2ldO1xuICAgICAgICBkcmF3UGxhbnQocC54LCBwLnksIHAud2lkdGgsIHAuaGVpZ2h0LCBwLmltYWdlRmlsZU5hbWUpO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgY2xlYXJDYW52YXMsXG4gICAgZHJhd0JlZCxcbiAgICBkcmF3QWxsXG59O1xuIiwiY29uc3QgbW91c2VFdmVudEhhbmRsZXJzID0gcmVxdWlyZSgnLi9tb3VzZS1ldmVudC1oYW5kbGVycycpO1xuY29uc3QgZHJhd09uQ2FudmFzID0gcmVxdWlyZSgnLi9kcmF3LW9uLWNhbnZhcycpO1xuXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcbmNvbnN0IGNhbnZhc0NvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuZnVuY3Rpb24gcmVuZGVyRWRpdEZvcm1Gb3JDdXJyZW50bHlTZWxlY3RlZEJlZCgpIHtcbiAgICBjb25zdCBjdXJyZW50U2VsZWN0ZWQgPSB3aW5kb3cucGxhbnRNYW5hZ2VyLm1vdXNlRXZlbnRWYXJpYWJsZXMuY3VycmVudFJlY3RTZWxlY3RlZDtcbiAgICBpZiAoIWN1cnJlbnRTZWxlY3RlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlQmVkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS11cGRhdGUtYmVkXScpO1xuICAgIGNvbnN0IG5hbWUgPSBjdXJyZW50U2VsZWN0ZWQubmFtZTtcbiAgICBjb25zdCB3aWR0aCA9IGN1cnJlbnRTZWxlY3RlZC53aWR0aDtcbiAgICBjb25zdCBoZWlnaHQgPSBjdXJyZW50U2VsZWN0ZWQuaGVpZ2h0O1xuICAgIGNvbnN0IGZpbGwgPSBjdXJyZW50U2VsZWN0ZWQuZmlsbDtcbiAgICBjb25zdCBzb2lsQ2hhcmFjdGVyaXN0aWNzID0gY3VycmVudFNlbGVjdGVkLnNvaWxfY2hhcmFjdGVyaXN0aWNzO1xuICAgIGNvbnN0IHR5cGUgPSBjdXJyZW50U2VsZWN0ZWQuYmVkX3R5cGU7XG5cbiAgICB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1uYW1lXScpLnZhbHVlID0gbmFtZTtcbiAgICB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC13aWR0aF0nKS52YWx1ZSA9IHdpZHRoO1xuICAgIHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLWhlaWdodF0nKS52YWx1ZSA9IGhlaWdodDtcbiAgICB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1jb2xvdXJdJykudmFsdWUgPSBmaWxsO1xuICAgIHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLXNvaWwtY2hhcmFjdGVyaXN0aWNzXScpLnZhbHVlID0gc29pbENoYXJhY3RlcmlzdGljcztcbiAgICB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC10eXBlXScpLnZhbHVlID0gdHlwZTtcbn1cblxud2luZG93LnBsYW50TWFuYWdlciA9IHtcbiAgICBjYW52YXNPZmZzZXRYOiBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCxcbiAgICBjYW52YXNPZmZzZXRZOiBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wLFxuICAgIGJlZHM6IFtdLFxuICAgIHBsYW50czogW10sXG4gICAgcmVuZGVyRWRpdEZvcm1Gb3JDdXJyZW50bHlTZWxlY3RlZEJlZDogcmVuZGVyRWRpdEZvcm1Gb3JDdXJyZW50bHlTZWxlY3RlZEJlZFxufTtcbmNvbnN0IHBtID0gd2luZG93LnBsYW50TWFuYWdlcjtcblxuY2FudmFzQ29udGV4dC5maWxsU3R5bGUgPSBcIiNhZjg2NWQzZFwiO1xuY2FudmFzQ29udGV4dC5maWxsUmVjdCgwLDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbm1vdXNlRXZlbnRIYW5kbGVycy5zZXR1cE1vdXNlRXZlbnRWYXJpYWJsZXMoKTtcbmNhbnZhcy5vbm1vdXNlZG93biA9IG1vdXNlRXZlbnRIYW5kbGVycy5tb3VzZURvd25IYW5kbGVyO1xuY2FudmFzLm9ubW91c2V1cCA9IG1vdXNlRXZlbnRIYW5kbGVycy5tb3VzZVVwSGFuZGxlcjtcbmNhbnZhcy5vbm1vdXNlbW92ZSA9IG1vdXNlRXZlbnRIYW5kbGVycy5tb3VzZU1vdmVIYW5kbGVyO1xuXG5kcmF3T25DYW52YXMuZHJhd0FsbCgpO1xucG0uZHJhd0FsbCA9IGRyYXdPbkNhbnZhcy5kcmF3QWxsO1xuIiwiY29uc3QgZHJhd09uQ2FudmFzID0gcmVxdWlyZSgnLi9kcmF3LW9uLWNhbnZhcycpO1xuXG5mdW5jdGlvbiBtb3VzZVVwSGFuZGxlcihlKSB7XG4gICAgY29uc3QgcG0gPSB3aW5kb3cucGxhbnRNYW5hZ2VyO1xuICAgIGNvbnN0IG1vdXNlRXZlbnRWYXJzID0gcG0ubW91c2VFdmVudFZhcmlhYmxlcztcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIC8vIGNsZWFyIGFsbCB0aGUgZHJhZ2dpbmcgZmxhZ3NcbiAgICBtb3VzZUV2ZW50VmFycy5zb21ldGhpbmdJc0JlaW5nRHJhZ2dlZCA9IGZhbHNlO1xuXG4gICAgZm9yIChsZXQgeiA9IDA7IHogPCBwbS5iZWRzLmxlbmd0aDsgeisrKSB7XG4gICAgICAgIHBtLmJlZHNbel0uaXNEcmFnZ2luZyA9IGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGxldCB6ID0gMDsgeiA8IHBtLnBsYW50cy5sZW5ndGg7IHorKykge1xuICAgICAgICBwbS5wbGFudHNbel0uaXNEcmFnZ2luZyA9IGZhbHNlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbW91c2VEb3duSGFuZGxlcihlKSB7XG4gICAgY29uc3QgcG0gPSB3aW5kb3cucGxhbnRNYW5hZ2VyO1xuICAgIGNvbnN0IG1vdXNlRXZlbnRWYXJzID0gcG0ubW91c2VFdmVudFZhcmlhYmxlcztcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIC8vIGdldCB0aGUgY3VycmVudCBtb3VzZSBwb3NpdGlvblxuICAgIGNvbnN0IG14ID0gcGFyc2VJbnQoZS5jbGllbnRYIC0gcG0uY2FudmFzT2Zmc2V0WCk7XG4gICAgY29uc3QgbXkgPSBwYXJzZUludChlLmNsaWVudFkgLSBwbS5jYW52YXNPZmZzZXRZKTtcblxuICAgIC8vIGNsZWFyIGFsbCB0aGUgZHJhZ2dpbmcgZmxhZ3NcbiAgICBtb3VzZUV2ZW50VmFycy5zb21ldGhpbmdJc0JlaW5nRHJhZ2dlZCA9IGZhbHNlO1xuXG4gICAgLy8gdGVzdCBlYWNoIHJlY3QgdG8gc2VlIGlmIG1vdXNlIGlzIGluc2lkZVxuICAgIGZvciAobGV0IGkgPSAocG0uYmVkcy5sZW5ndGggLSAxKTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgY29uc3QgYiA9IHBtLmJlZHNbaV07XG4gICAgICAgIGlmIChteCA+IHBhcnNlSW50KGIueCwgMTApICYmIG14IDwgcGFyc2VJbnQoYi54LCAxMCkgKyBwYXJzZUludChiLndpZHRoLCAxMCkgJiYgbXkgPiBwYXJzZUludChiLnksIDEwKSAmJiBteSA8IHBhcnNlSW50KGIueSwgMTApICsgcGFyc2VJbnQoYi5oZWlnaHQsIDEwKSkge1xuICAgICAgICAgICAgLy8gaWYgeWVzLCBzZXQgdGhhdCByZWN0cyBpc0RyYWdnaW5nPXRydWVcbiAgICAgICAgICAgIG1vdXNlRXZlbnRWYXJzLnNvbWV0aGluZ0lzQmVpbmdEcmFnZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIG1vdXNlRXZlbnRWYXJzLmN1cnJlbnRSZWN0U2VsZWN0ZWQgPSBiO1xuICAgICAgICAgICAgYi5pc0RyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHBtLnJlbmRlckVkaXRGb3JtRm9yQ3VycmVudGx5U2VsZWN0ZWRCZWQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAocG0ucGxhbnRzLmxlbmd0aCAtIDEpOyBpID49IDA7IGktLSkge1xuICAgICAgICBjb25zdCBwID0gcG0ucGxhbnRzW2ldO1xuICAgICAgICBpZiAobXggPiBwYXJzZUludChwLngsIDEwKSAmJiBteCA8IHBhcnNlSW50KHAueCwgMTApICsgcGFyc2VJbnQocC53aWR0aCwgMTApICYmIG15ID4gcGFyc2VJbnQocC55LCAxMCkgJiYgbXkgPCBwYXJzZUludChwLnksIDEwKSArIHBhcnNlSW50KHAuaGVpZ2h0LCAxMCkpIHtcbiAgICAgICAgICAgIC8vIGlmIHllcywgc2V0IHRoYXQgcmVjdHMgaXNEcmFnZ2luZz10cnVlXG4gICAgICAgICAgICBtb3VzZUV2ZW50VmFycy5zb21ldGhpbmdJc0JlaW5nRHJhZ2dlZCA9IHRydWU7XG4gICAgICAgICAgICBtb3VzZUV2ZW50VmFycy5jdXJyZW50UmVjdFNlbGVjdGVkID0gcDtcbiAgICAgICAgICAgIHAuaXNEcmFnZ2luZyA9IHRydWU7XG4gICAgICAgICAgICAvLyBwbS5yZW5kZXJFZGl0Rm9ybUZvckN1cnJlbnRseVNlbGVjdGVkUGxhbnQoKTsgICA8LS0tIFRPRE9cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIHNhdmUgdGhlIGN1cnJlbnQgbW91c2UgcG9zaXRpb25cbiAgICBtb3VzZUV2ZW50VmFycy5zdGFydFggPSBteDtcbiAgICBtb3VzZUV2ZW50VmFycy5zdGFydFkgPSBteTtcbn1cblxuZnVuY3Rpb24gbW91c2VNb3ZlSGFuZGxlcihlKSB7XG4gICAgY29uc3QgcG0gPSB3aW5kb3cucGxhbnRNYW5hZ2VyO1xuICAgIGNvbnN0IG1vdXNlRXZlbnRWYXJzID0gcG0ubW91c2VFdmVudFZhcmlhYmxlcztcbiAgICAvLyBpZiB3ZSdyZSBkcmFnZ2luZyBhbnl0aGluZy4uLlxuICAgIGlmIChtb3VzZUV2ZW50VmFycy5zb21ldGhpbmdJc0JlaW5nRHJhZ2dlZCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgLy8gZ2V0IHRoZSBjdXJyZW50IG1vdXNlIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IG14ID0gcGFyc2VJbnQoZS5jbGllbnRYIC0gcG0uY2FudmFzT2Zmc2V0WCk7XG4gICAgICAgIGNvbnN0IG15ID0gcGFyc2VJbnQoZS5jbGllbnRZIC0gcG0uY2FudmFzT2Zmc2V0WSk7XG5cbiAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBkaXN0YW5jZSB0aGUgbW91c2UgaGFzIG1vdmVkXG4gICAgICAgIC8vIHNpbmNlIHRoZSBsYXN0IG1vdXNlbW92ZVxuICAgICAgICBjb25zdCBkeCA9IG14IC0gbW91c2VFdmVudFZhcnMuc3RhcnRYO1xuICAgICAgICBjb25zdCBkeSA9IG15IC0gbW91c2VFdmVudFZhcnMuc3RhcnRZO1xuXG4gICAgICAgIC8vIG1vdmUgZWFjaCByZWN0IHRoYXQgaXNEcmFnZ2luZ1xuICAgICAgICAvLyBieSB0aGUgZGlzdGFuY2UgdGhlIG1vdXNlIGhhcyBtb3ZlZFxuICAgICAgICAvLyBzaW5jZSB0aGUgbGFzdCBtb3VzZW1vdmVcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbS5iZWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBiID0gcG0uYmVkc1tpXTtcbiAgICAgICAgICAgIGlmIChiLmlzRHJhZ2dpbmcpIHtcbiAgICAgICAgICAgICAgICBiLnggKz0gZHg7XG4gICAgICAgICAgICAgICAgYi55ICs9IGR5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbS5wbGFudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBwbS5wbGFudHNbaV07XG4gICAgICAgICAgICBpZiAocC5pc0RyYWdnaW5nKSB7XG4gICAgICAgICAgICAgICAgcC54ICs9IGR4O1xuICAgICAgICAgICAgICAgIHAueSArPSBkeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlZHJhdyB0aGUgc2NlbmUgd2l0aCB0aGUgbmV3IHJlY3QgcG9zaXRpb25zXG4gICAgICAgIGRyYXdPbkNhbnZhcy5kcmF3QWxsKCk7XG5cbiAgICAgICAgLy8gcmVzZXQgdGhlIHN0YXJ0aW5nIG1vdXNlIHBvc2l0aW9uIGZvciB0aGUgbmV4dCBtb3VzZW1vdmVcbiAgICAgICAgbW91c2VFdmVudFZhcnMuc3RhcnRYID0gbXg7XG4gICAgICAgIG1vdXNlRXZlbnRWYXJzLnN0YXJ0WSA9IG15O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc2V0dXBNb3VzZUV2ZW50VmFyaWFibGVzKCkge1xuICAgIGNvbnN0IHBtID0gd2luZG93LnBsYW50TWFuYWdlcjtcbiAgICBjb25zdCBtb3VzZUV2ZW50VmFycyA9IHBtLm1vdXNlRXZlbnRWYXJpYWJsZXMgPSB7fTtcbiAgICBtb3VzZUV2ZW50VmFycy5zb21ldGhpbmdJc0JlaW5nRHJhZ2dlZCA9IGZhbHNlO1xuICAgIG1vdXNlRXZlbnRWYXJzLmN1cnJlbnRSZWN0U2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gICAgbW91c2VFdmVudFZhcnMuc3RhcnRYID0gdW5kZWZpbmVkO1xuICAgIG1vdXNlRXZlbnRWYXJzLnN0YXJ0WSA9IHVuZGVmaW5lZDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgbW91c2VVcEhhbmRsZXIsXG4gICAgbW91c2VEb3duSGFuZGxlcixcbiAgICBtb3VzZU1vdmVIYW5kbGVyLFxuICAgIHNldHVwTW91c2VFdmVudFZhcmlhYmxlc1xufTtcbiJdfQ=="}