{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/app.js","src/http-requests.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const httpRequests = require('./http-requests');\n\nfunction closeAllOverlays() {\n    const overlays = document.querySelectorAll('.overlay');\n    overlays.forEach(el => {el.classList.add('hidden')});\n}\n\nfunction retrieveBedFromWindowObject(name) {\n    const beds = window.plantManager.beds;\n    for (let i = 0; i < beds.length; i++) {\n        if (beds[i].name === name) {\n            return beds[i];\n        }\n    }\n}\n\nfunction createBedRectInWindow() {\n    const createBedForm = document.querySelector('form[data-create-bed]');\n    window.plantManager.beds.push({\n        name: createBedForm.querySelector('input[data-bed-name]').value,\n        x: 50,\n        y: 50,\n        width: createBedForm.querySelector('input[data-bed-width]').value,\n        height: createBedForm.querySelector('input[data-bed-height]').value,\n        fill: createBedForm.querySelector('input[data-bed-colour]').value,\n        soil_characteristics: createBedForm.querySelector('select[data-bed-soil-characteristics]').value,\n        bed_type: createBedForm.querySelector('select[data-bed-type]').value,\n        isDragging: false\n    });\n}\n\nfunction updateBedRectInWindow() {\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = updateBedForm.querySelector('[data-bed-name]').value;\n    const bed = retrieveBedFromWindowObject(name);\n    bed.name = name;\n    bed.width = parseInt(updateBedForm.querySelector('[data-bed-width]').value, 10);\n    bed.height = parseInt(updateBedForm.querySelector('[data-bed-height]').value, 10);\n    bed.fill = updateBedForm.querySelector('[data-bed-colour]').value;\n    bed.soilCharacteristics = updateBedForm.querySelector('[data-bed-soil-characteristics]').value;\n    bed.type = updateBedForm.querySelector('[data-bed-type]').value;\n}\n\nfunction populateBedDropdowns(bedObj) {\n    const name = bedObj.bed_name;\n    Array.prototype.slice.call(document.querySelectorAll('select[data-plant-bed]')).forEach(selectEl => {\n        const el = document.createElement('option');\n        el.setAttribute('value', name);\n        el.textContent = name;\n        selectEl.appendChild(el);\n    })\n}\n\ndocument.querySelector('form[data-create-plant]').addEventListener('submit', event => {\n    event.preventDefault();\n    httpRequests.sendCreatePlantRequest();\n    closeAllOverlays();\n});\n\ndocument.querySelector('form[data-create-bed]').addEventListener('submit', event => {\n    event.preventDefault();\n    httpRequests.sendCreateBedRequest();\n    createBedRectInWindow();\n    window.plantManager.drawAll();\n    closeAllOverlays();\n});\n\ndocument.querySelector('button[data-update-beds]').addEventListener('click', event => {\n    event.preventDefault();\n    httpRequests.sendSaveAllBedPositionsRequest();\n    httpRequests.sendSaveAllPlantPositionsRequest();\n});\n\ndocument.querySelector('input[data-save-bed]').addEventListener('click', event => {\n    event.preventDefault();\n    updateBedRectInWindow();\n    httpRequests.sendSaveBedRequest();\n    window.plantManager.drawAll();\n});\n\ndocument.querySelector('input[data-save-plant]').addEventListener('click', event => {\n    event.preventDefault();\n    httpRequests.sendSavePlantRequest();\n    window.plantManager.drawAll();\n});\n\ndocument.querySelector('input[data-delete-bed]').addEventListener('click', event => {\n    event.preventDefault();\n    httpRequests.sendDeleteBedRequest();\n    window.plantManager.drawAll();\n});\n\ndocument.querySelector('input[data-delete-plant]').addEventListener('click', event => {\n    event.preventDefault();\n    httpRequests.sendDeletePlantRequest();\n    window.plantManager.drawAll();\n});\n\n[].slice.call(document.querySelectorAll('[data-open-overlay]')).forEach(button => {\n    const overlayName = button.dataset.openOverlay;\n    button.addEventListener('click', event => {\n        event.preventDefault();\n        document.querySelector(`div[data-${overlayName}-overlay]`).classList.remove('hidden');\n    });\n});\n\n[].slice.call(document.querySelectorAll('[data-close-overlay]')).forEach(button => {\n    const overlayName = button.dataset.closeOverlay;\n    button.addEventListener('click', event => {\n        event.preventDefault();\n        document.querySelector(`div[data-${overlayName}-overlay]`).classList.add('hidden');\n    });\n});\n\nhttpRequests.get('/getBeds').then(response => {\n    response.json().then(data => {\n        let i = 1;\n        data.forEach(obj => {\n            window.plantManager.beds.push({\n                name: obj.bed_name,\n                x: obj.bed_x,\n                y: obj.bed_y,\n                width: obj.bed_width,\n                height: obj.bed_height,\n                fill: obj.bed_colour,\n                soil_characteristics: obj.bed_soil_characteristics,\n                bed_type: obj.bed_type,\n                isDragging: false,\n            });\n            if(i < 32) {\n                document.querySelector(`[data-table-name-${i}]`).setAttribute('value', obj.bed_name);\n                document.querySelector(`[data-table-type-${i}]`).setAttribute('value', obj.bed_type);\n                document.querySelector(`[data-table-soil-characteristics-${i}]`).setAttribute('value', obj.bed_soil_characteristics);\n                document.querySelector(`[data-table-name-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-table-type-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-table-soil-characteristics-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-tr-${i}]`).dataset.empty = \"false\";\n                i++;\n            }\n            populateBedDropdowns(obj);\n        });\n        window.plantManager.drawAll();\n    });\n});\n\nhttpRequests.get('/getPlants').then(response => {\n    response.json().then(data => {\n        let i = 1;\n        data.forEach(obj => {\n            window.plantManager.plants.push({\n                name: obj.plant_name,\n                bed: obj.plant_bed,\n                type: obj.plant_type,\n                datePlanted: obj.plant_date_planted,\n                lastCrop: obj.plant_last_crop,\n                nextCrop: obj.plant_next_crop,\n                imageFileName: obj.plant_icon,\n                x: obj.plant_x,\n                y: obj.plant_y,\n                width: 35,\n                height: 35,\n                isDragging: false\n            });\n            if(i < 32) {\n                document.querySelector(`[data-table-plant-name-${i}]`).setAttribute('value', obj.plant_name);\n                document.querySelector(`[data-table-plant-bed-${i}]`).setAttribute('value', obj.plant_bed);\n                document.querySelector(`[data-table-plant-type-${i}]`).setAttribute('value', obj.plant_type);\n                document.querySelector(`[data-table-plant-date-planted-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-table-plant-last-crop-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-table-plant-next-crop-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-plant-tr-${i}]`).dataset.empty = \"false\";\n                i++;\n            }\n        });\n        window.plantManager.drawAll();\n    });\n});\n","function sendCreatePlantRequest() {\n    const createPlantForm = document.querySelector('form[data-create-plant]');\n    const plant_name = createPlantForm.querySelector('input[data-plant-name]').value;\n    const plant_bed = createPlantForm.querySelector('select[data-plant-bed]').value;\n    const plant_type = createPlantForm.querySelector('select[data-plant-type]').value;\n    const plant_date_planted = createPlantForm.querySelector('input[data-plant-date-planted]').value;\n    const plant_last_crop = createPlantForm.querySelector('input[data-plant-last-crop]').value;\n    const plant_next_crop = createPlantForm.querySelector('input[data-plant-next-crop]').value;\n    const plant_icon = createPlantForm.querySelector('select[data-plant-icon]').value;\n    post('/createPlant', {plant_name, plant_bed, plant_type, plant_date_planted, plant_last_crop, plant_next_crop, plant_icon});\n}\n\nfunction sendCreateBedRequest() {\n    const createBedForm = document.querySelector('form[data-create-bed]');\n    const bed_name = createBedForm.querySelector('input[data-bed-name]').value;\n    const bed_soil_characteristics = createBedForm.querySelector('select[data-bed-soil-characteristics]').value;\n    const bed_type = createBedForm.querySelector('select[data-bed-type]').value;\n    const bed_width = createBedForm.querySelector('input[data-bed-width]').value;\n    const bed_height = createBedForm.querySelector('input[data-bed-height]').value;\n    const bed_colour = createBedForm.querySelector('input[data-bed-colour]').value;\n    const bed_x = 200;\n    const bed_y = 300;\n    post('/createBed', {bed_name, bed_soil_characteristics, bed_type, bed_width, bed_height, bed_colour, bed_x, bed_y});\n}\n\nfunction sendSaveAllBedPositionsRequest() {\n    const pm = window.plantManager;\n    for (let z = 0; z < pm.beds.length; z++) {\n        post('/updateBedPosition',{bed_name: pm.beds[z].name, bed_x: pm.beds[z].x, bed_y: pm.beds[z].y});\n    }\n}\n\nfunction sendSaveAllPlantPositionsRequest() {\n    const pm = window.plantManager;\n    for (let z = 0; z < pm.plants.length; z++) {\n        post('/updatePlantPosition',{plant_name: pm.plants[z].name, plant_bed: pm.plants[z].bed, plant_x: pm.plants[z].x, plant_y: pm.plants[z].y});\n    }\n}\n\nfunction sendSaveBedRequest() {\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = updateBedForm.querySelector('[data-bed-name]').value;\n    const width = updateBedForm.querySelector('[data-bed-width]').value;\n    const height = updateBedForm.querySelector('[data-bed-height]').value;\n    const fill = updateBedForm.querySelector('[data-bed-colour]').value;\n    const soilCharacteristics = updateBedForm.querySelector('[data-bed-soil-characteristics]').value;\n    const type = updateBedForm.querySelector('[data-bed-type]').value;\n    post('/updateBed',{bed_name: name, bed_soil_characteristics: soilCharacteristics, bed_type: type, bed_width: width, bed_height: height, bed_colour: fill});\n}\n\nfunction sendSavePlantRequest() {\n    const updatePlantForm = document.querySelector('form[data-update-plant]');\n    const name = updatePlantForm.querySelector('[data-plant-name]').value;\n    const bed = updatePlantForm.querySelector('[data-plant-bed]').value;\n    const type = updatePlantForm.querySelector('[data-plant-type]').value;\n    const datePlanted = updatePlantForm.querySelector('[data-plant-date-planted]').value;\n    const lastCrop = updatePlantForm.querySelector('[data-plant-last-crop]').value;\n    const nextCrop = updatePlantForm.querySelector('[data-plant-next-crop]').value;\n    const icon = updatePlantForm.querySelector('[data-plant-icon]').value;\n    post('/updatePlant',{plant_name: name, plant_bed: bed, plant_type: type, plant_date_planted: datePlanted, plant_last_crop: lastCrop, plant_next_crop: nextCrop, plant_icon: icon});\n}\n\nfunction sendDeleteBedRequest() {\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = updateBedForm.querySelector('[data-bed-name]').value;\n    window.plantManager.beds = window.plantManager.beds.filter(obj => {\n        return obj.name !== name;\n    });\n    post('/deleteBed',{bed_name: name});\n}\n\nfunction sendDeletePlantRequest() {\n    const updatePlantForm = document.querySelector('form[data-update-plant]');\n    const name = updatePlantForm.querySelector('[data-plant-name]').value;\n    window.plantManager.plants = window.plantManager.plants.filter(obj => {\n        return obj.name !== name;\n    });\n    post('/deletePlant',{plant_name: name});\n}\n\nfunction post(path, data) {\n    return window.fetch(path, {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(data)\n    });\n}\n\nfunction get(path) {\n    return window.fetch(path, {\n        method: 'GET',\n        headers: {\n            'Accept': 'application/json',\n            'Cache-Control': 'no-cache, no-store, must-revalidate',\n            'Pragma': 'no-cache',\n            'Expires': 0\n        }\n    });\n}\n\nmodule.exports = {\n    sendCreatePlantRequest,\n    sendCreateBedRequest,\n    sendSaveAllBedPositionsRequest,\n    sendSaveAllPlantPositionsRequest,\n    sendSaveBedRequest,\n    sendSavePlantRequest,\n    sendDeleteBedRequest,\n    sendDeletePlantRequest,\n    get,\n    post\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIiwic3JjL2h0dHAtcmVxdWVzdHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGh0dHBSZXF1ZXN0cyA9IHJlcXVpcmUoJy4vaHR0cC1yZXF1ZXN0cycpO1xuXG5mdW5jdGlvbiBjbG9zZUFsbE92ZXJsYXlzKCkge1xuICAgIGNvbnN0IG92ZXJsYXlzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm92ZXJsYXknKTtcbiAgICBvdmVybGF5cy5mb3JFYWNoKGVsID0+IHtlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKX0pO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUJlZEZyb21XaW5kb3dPYmplY3QobmFtZSkge1xuICAgIGNvbnN0IGJlZHMgPSB3aW5kb3cucGxhbnRNYW5hZ2VyLmJlZHM7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiZWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChiZWRzW2ldLm5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBiZWRzW2ldO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVCZWRSZWN0SW5XaW5kb3coKSB7XG4gICAgY29uc3QgY3JlYXRlQmVkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS1jcmVhdGUtYmVkXScpO1xuICAgIHdpbmRvdy5wbGFudE1hbmFnZXIuYmVkcy5wdXNoKHtcbiAgICAgICAgbmFtZTogY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWJlZC1uYW1lXScpLnZhbHVlLFxuICAgICAgICB4OiA1MCxcbiAgICAgICAgeTogNTAsXG4gICAgICAgIHdpZHRoOiBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtYmVkLXdpZHRoXScpLnZhbHVlLFxuICAgICAgICBoZWlnaHQ6IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1iZWQtaGVpZ2h0XScpLnZhbHVlLFxuICAgICAgICBmaWxsOiBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtYmVkLWNvbG91cl0nKS52YWx1ZSxcbiAgICAgICAgc29pbF9jaGFyYWN0ZXJpc3RpY3M6IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3Rvcignc2VsZWN0W2RhdGEtYmVkLXNvaWwtY2hhcmFjdGVyaXN0aWNzXScpLnZhbHVlLFxuICAgICAgICBiZWRfdHlwZTogY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdzZWxlY3RbZGF0YS1iZWQtdHlwZV0nKS52YWx1ZSxcbiAgICAgICAgaXNEcmFnZ2luZzogZmFsc2VcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlQmVkUmVjdEluV2luZG93KCkge1xuICAgIGNvbnN0IHVwZGF0ZUJlZEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW2RhdGEtdXBkYXRlLWJlZF0nKTtcbiAgICBjb25zdCBuYW1lID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtbmFtZV0nKS52YWx1ZTtcbiAgICBjb25zdCBiZWQgPSByZXRyaWV2ZUJlZEZyb21XaW5kb3dPYmplY3QobmFtZSk7XG4gICAgYmVkLm5hbWUgPSBuYW1lO1xuICAgIGJlZC53aWR0aCA9IHBhcnNlSW50KHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLXdpZHRoXScpLnZhbHVlLCAxMCk7XG4gICAgYmVkLmhlaWdodCA9IHBhcnNlSW50KHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLWhlaWdodF0nKS52YWx1ZSwgMTApO1xuICAgIGJlZC5maWxsID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtY29sb3VyXScpLnZhbHVlO1xuICAgIGJlZC5zb2lsQ2hhcmFjdGVyaXN0aWNzID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtc29pbC1jaGFyYWN0ZXJpc3RpY3NdJykudmFsdWU7XG4gICAgYmVkLnR5cGUgPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC10eXBlXScpLnZhbHVlO1xufVxuXG5mdW5jdGlvbiBwb3B1bGF0ZUJlZERyb3Bkb3ducyhiZWRPYmopIHtcbiAgICBjb25zdCBuYW1lID0gYmVkT2JqLmJlZF9uYW1lO1xuICAgIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3NlbGVjdFtkYXRhLXBsYW50LWJlZF0nKSkuZm9yRWFjaChzZWxlY3RFbCA9PiB7XG4gICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBuYW1lKTtcbiAgICAgICAgZWwudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgICAgICBzZWxlY3RFbC5hcHBlbmRDaGlsZChlbCk7XG4gICAgfSlcbn1cblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtkYXRhLWNyZWF0ZS1wbGFudF0nKS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBldmVudCA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBodHRwUmVxdWVzdHMuc2VuZENyZWF0ZVBsYW50UmVxdWVzdCgpO1xuICAgIGNsb3NlQWxsT3ZlcmxheXMoKTtcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW2RhdGEtY3JlYXRlLWJlZF0nKS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBldmVudCA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBodHRwUmVxdWVzdHMuc2VuZENyZWF0ZUJlZFJlcXVlc3QoKTtcbiAgICBjcmVhdGVCZWRSZWN0SW5XaW5kb3coKTtcbiAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmRyYXdBbGwoKTtcbiAgICBjbG9zZUFsbE92ZXJsYXlzKCk7XG59KTtcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYnV0dG9uW2RhdGEtdXBkYXRlLWJlZHNdJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBodHRwUmVxdWVzdHMuc2VuZFNhdmVBbGxCZWRQb3NpdGlvbnNSZXF1ZXN0KCk7XG4gICAgaHR0cFJlcXVlc3RzLnNlbmRTYXZlQWxsUGxhbnRQb3NpdGlvbnNSZXF1ZXN0KCk7XG59KTtcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1zYXZlLWJlZF0nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHVwZGF0ZUJlZFJlY3RJbldpbmRvdygpO1xuICAgIGh0dHBSZXF1ZXN0cy5zZW5kU2F2ZUJlZFJlcXVlc3QoKTtcbiAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmRyYXdBbGwoKTtcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLXNhdmUtcGxhbnRdJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBodHRwUmVxdWVzdHMuc2VuZFNhdmVQbGFudFJlcXVlc3QoKTtcbiAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmRyYXdBbGwoKTtcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWRlbGV0ZS1iZWRdJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBodHRwUmVxdWVzdHMuc2VuZERlbGV0ZUJlZFJlcXVlc3QoKTtcbiAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmRyYXdBbGwoKTtcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWRlbGV0ZS1wbGFudF0nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGh0dHBSZXF1ZXN0cy5zZW5kRGVsZXRlUGxhbnRSZXF1ZXN0KCk7XG4gICAgd2luZG93LnBsYW50TWFuYWdlci5kcmF3QWxsKCk7XG59KTtcblxuW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1vcGVuLW92ZXJsYXldJykpLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICBjb25zdCBvdmVybGF5TmFtZSA9IGJ1dHRvbi5kYXRhc2V0Lm9wZW5PdmVybGF5O1xuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2RhdGEtJHtvdmVybGF5TmFtZX0tb3ZlcmxheV1gKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICB9KTtcbn0pO1xuXG5bXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWNsb3NlLW92ZXJsYXldJykpLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICBjb25zdCBvdmVybGF5TmFtZSA9IGJ1dHRvbi5kYXRhc2V0LmNsb3NlT3ZlcmxheTtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdltkYXRhLSR7b3ZlcmxheU5hbWV9LW92ZXJsYXldYCkuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgfSk7XG59KTtcblxuaHR0cFJlcXVlc3RzLmdldCgnL2dldEJlZHMnKS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICByZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcbiAgICAgICAgbGV0IGkgPSAxO1xuICAgICAgICBkYXRhLmZvckVhY2gob2JqID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5wbGFudE1hbmFnZXIuYmVkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBvYmouYmVkX25hbWUsXG4gICAgICAgICAgICAgICAgeDogb2JqLmJlZF94LFxuICAgICAgICAgICAgICAgIHk6IG9iai5iZWRfeSxcbiAgICAgICAgICAgICAgICB3aWR0aDogb2JqLmJlZF93aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IG9iai5iZWRfaGVpZ2h0LFxuICAgICAgICAgICAgICAgIGZpbGw6IG9iai5iZWRfY29sb3VyLFxuICAgICAgICAgICAgICAgIHNvaWxfY2hhcmFjdGVyaXN0aWNzOiBvYmouYmVkX3NvaWxfY2hhcmFjdGVyaXN0aWNzLFxuICAgICAgICAgICAgICAgIGJlZF90eXBlOiBvYmouYmVkX3R5cGUsXG4gICAgICAgICAgICAgICAgaXNEcmFnZ2luZzogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmKGkgPCAzMikge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRhYmxlLW5hbWUtJHtpfV1gKS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb2JqLmJlZF9uYW1lKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS10eXBlLSR7aX1dYCkuc2V0QXR0cmlidXRlKCd2YWx1ZScsIG9iai5iZWRfdHlwZSk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFibGUtc29pbC1jaGFyYWN0ZXJpc3RpY3MtJHtpfV1gKS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb2JqLmJlZF9zb2lsX2NoYXJhY3RlcmlzdGljcyk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFibGUtbmFtZS0ke2l9XWApLmRhdGFzZXQuZW1wdHkgPSBcImZhbHNlXCI7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFibGUtdHlwZS0ke2l9XWApLmRhdGFzZXQuZW1wdHkgPSBcImZhbHNlXCI7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFibGUtc29pbC1jaGFyYWN0ZXJpc3RpY3MtJHtpfV1gKS5kYXRhc2V0LmVtcHR5ID0gXCJmYWxzZVwiO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRyLSR7aX1dYCkuZGF0YXNldC5lbXB0eSA9IFwiZmFsc2VcIjtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3B1bGF0ZUJlZERyb3Bkb3ducyhvYmopO1xuICAgICAgICB9KTtcbiAgICAgICAgd2luZG93LnBsYW50TWFuYWdlci5kcmF3QWxsKCk7XG4gICAgfSk7XG59KTtcblxuaHR0cFJlcXVlc3RzLmdldCgnL2dldFBsYW50cycpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICBsZXQgaSA9IDE7XG4gICAgICAgIGRhdGEuZm9yRWFjaChvYmogPT4ge1xuICAgICAgICAgICAgd2luZG93LnBsYW50TWFuYWdlci5wbGFudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogb2JqLnBsYW50X25hbWUsXG4gICAgICAgICAgICAgICAgYmVkOiBvYmoucGxhbnRfYmVkLFxuICAgICAgICAgICAgICAgIHR5cGU6IG9iai5wbGFudF90eXBlLFxuICAgICAgICAgICAgICAgIGRhdGVQbGFudGVkOiBvYmoucGxhbnRfZGF0ZV9wbGFudGVkLFxuICAgICAgICAgICAgICAgIGxhc3RDcm9wOiBvYmoucGxhbnRfbGFzdF9jcm9wLFxuICAgICAgICAgICAgICAgIG5leHRDcm9wOiBvYmoucGxhbnRfbmV4dF9jcm9wLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZU5hbWU6IG9iai5wbGFudF9pY29uLFxuICAgICAgICAgICAgICAgIHg6IG9iai5wbGFudF94LFxuICAgICAgICAgICAgICAgIHk6IG9iai5wbGFudF95LFxuICAgICAgICAgICAgICAgIHdpZHRoOiAzNSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDM1LFxuICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmc6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmKGkgPCAzMikge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRhYmxlLXBsYW50LW5hbWUtJHtpfV1gKS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb2JqLnBsYW50X25hbWUpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRhYmxlLXBsYW50LWJlZC0ke2l9XWApLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBvYmoucGxhbnRfYmVkKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS1wbGFudC10eXBlLSR7aX1dYCkuc2V0QXR0cmlidXRlKCd2YWx1ZScsIG9iai5wbGFudF90eXBlKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS1wbGFudC1kYXRlLXBsYW50ZWQtJHtpfV1gKS5kYXRhc2V0LmVtcHR5ID0gXCJmYWxzZVwiO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRhYmxlLXBsYW50LWxhc3QtY3JvcC0ke2l9XWApLmRhdGFzZXQuZW1wdHkgPSBcImZhbHNlXCI7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFibGUtcGxhbnQtbmV4dC1jcm9wLSR7aX1dYCkuZGF0YXNldC5lbXB0eSA9IFwiZmFsc2VcIjtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1wbGFudC10ci0ke2l9XWApLmRhdGFzZXQuZW1wdHkgPSBcImZhbHNlXCI7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgd2luZG93LnBsYW50TWFuYWdlci5kcmF3QWxsKCk7XG4gICAgfSk7XG59KTtcbiIsImZ1bmN0aW9uIHNlbmRDcmVhdGVQbGFudFJlcXVlc3QoKSB7XG4gICAgY29uc3QgY3JlYXRlUGxhbnRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtkYXRhLWNyZWF0ZS1wbGFudF0nKTtcbiAgICBjb25zdCBwbGFudF9uYW1lID0gY3JlYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtcGxhbnQtbmFtZV0nKS52YWx1ZTtcbiAgICBjb25zdCBwbGFudF9iZWQgPSBjcmVhdGVQbGFudEZvcm0ucXVlcnlTZWxlY3Rvcignc2VsZWN0W2RhdGEtcGxhbnQtYmVkXScpLnZhbHVlO1xuICAgIGNvbnN0IHBsYW50X3R5cGUgPSBjcmVhdGVQbGFudEZvcm0ucXVlcnlTZWxlY3Rvcignc2VsZWN0W2RhdGEtcGxhbnQtdHlwZV0nKS52YWx1ZTtcbiAgICBjb25zdCBwbGFudF9kYXRlX3BsYW50ZWQgPSBjcmVhdGVQbGFudEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1wbGFudC1kYXRlLXBsYW50ZWRdJykudmFsdWU7XG4gICAgY29uc3QgcGxhbnRfbGFzdF9jcm9wID0gY3JlYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtcGxhbnQtbGFzdC1jcm9wXScpLnZhbHVlO1xuICAgIGNvbnN0IHBsYW50X25leHRfY3JvcCA9IGNyZWF0ZVBsYW50Rm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLXBsYW50LW5leHQtY3JvcF0nKS52YWx1ZTtcbiAgICBjb25zdCBwbGFudF9pY29uID0gY3JlYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ3NlbGVjdFtkYXRhLXBsYW50LWljb25dJykudmFsdWU7XG4gICAgcG9zdCgnL2NyZWF0ZVBsYW50Jywge3BsYW50X25hbWUsIHBsYW50X2JlZCwgcGxhbnRfdHlwZSwgcGxhbnRfZGF0ZV9wbGFudGVkLCBwbGFudF9sYXN0X2Nyb3AsIHBsYW50X25leHRfY3JvcCwgcGxhbnRfaWNvbn0pO1xufVxuXG5mdW5jdGlvbiBzZW5kQ3JlYXRlQmVkUmVxdWVzdCgpIHtcbiAgICBjb25zdCBjcmVhdGVCZWRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtkYXRhLWNyZWF0ZS1iZWRdJyk7XG4gICAgY29uc3QgYmVkX25hbWUgPSBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtYmVkLW5hbWVdJykudmFsdWU7XG4gICAgY29uc3QgYmVkX3NvaWxfY2hhcmFjdGVyaXN0aWNzID0gY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdzZWxlY3RbZGF0YS1iZWQtc29pbC1jaGFyYWN0ZXJpc3RpY3NdJykudmFsdWU7XG4gICAgY29uc3QgYmVkX3R5cGUgPSBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ3NlbGVjdFtkYXRhLWJlZC10eXBlXScpLnZhbHVlO1xuICAgIGNvbnN0IGJlZF93aWR0aCA9IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1iZWQtd2lkdGhdJykudmFsdWU7XG4gICAgY29uc3QgYmVkX2hlaWdodCA9IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1iZWQtaGVpZ2h0XScpLnZhbHVlO1xuICAgIGNvbnN0IGJlZF9jb2xvdXIgPSBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtYmVkLWNvbG91cl0nKS52YWx1ZTtcbiAgICBjb25zdCBiZWRfeCA9IDIwMDtcbiAgICBjb25zdCBiZWRfeSA9IDMwMDtcbiAgICBwb3N0KCcvY3JlYXRlQmVkJywge2JlZF9uYW1lLCBiZWRfc29pbF9jaGFyYWN0ZXJpc3RpY3MsIGJlZF90eXBlLCBiZWRfd2lkdGgsIGJlZF9oZWlnaHQsIGJlZF9jb2xvdXIsIGJlZF94LCBiZWRfeX0pO1xufVxuXG5mdW5jdGlvbiBzZW5kU2F2ZUFsbEJlZFBvc2l0aW9uc1JlcXVlc3QoKSB7XG4gICAgY29uc3QgcG0gPSB3aW5kb3cucGxhbnRNYW5hZ2VyO1xuICAgIGZvciAobGV0IHogPSAwOyB6IDwgcG0uYmVkcy5sZW5ndGg7IHorKykge1xuICAgICAgICBwb3N0KCcvdXBkYXRlQmVkUG9zaXRpb24nLHtiZWRfbmFtZTogcG0uYmVkc1t6XS5uYW1lLCBiZWRfeDogcG0uYmVkc1t6XS54LCBiZWRfeTogcG0uYmVkc1t6XS55fSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzZW5kU2F2ZUFsbFBsYW50UG9zaXRpb25zUmVxdWVzdCgpIHtcbiAgICBjb25zdCBwbSA9IHdpbmRvdy5wbGFudE1hbmFnZXI7XG4gICAgZm9yIChsZXQgeiA9IDA7IHogPCBwbS5wbGFudHMubGVuZ3RoOyB6KyspIHtcbiAgICAgICAgcG9zdCgnL3VwZGF0ZVBsYW50UG9zaXRpb24nLHtwbGFudF9uYW1lOiBwbS5wbGFudHNbel0ubmFtZSwgcGxhbnRfYmVkOiBwbS5wbGFudHNbel0uYmVkLCBwbGFudF94OiBwbS5wbGFudHNbel0ueCwgcGxhbnRfeTogcG0ucGxhbnRzW3pdLnl9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNlbmRTYXZlQmVkUmVxdWVzdCgpIHtcbiAgICBjb25zdCB1cGRhdGVCZWRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtkYXRhLXVwZGF0ZS1iZWRdJyk7XG4gICAgY29uc3QgbmFtZSA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLW5hbWVdJykudmFsdWU7XG4gICAgY29uc3Qgd2lkdGggPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC13aWR0aF0nKS52YWx1ZTtcbiAgICBjb25zdCBoZWlnaHQgPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1oZWlnaHRdJykudmFsdWU7XG4gICAgY29uc3QgZmlsbCA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLWNvbG91cl0nKS52YWx1ZTtcbiAgICBjb25zdCBzb2lsQ2hhcmFjdGVyaXN0aWNzID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtc29pbC1jaGFyYWN0ZXJpc3RpY3NdJykudmFsdWU7XG4gICAgY29uc3QgdHlwZSA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLXR5cGVdJykudmFsdWU7XG4gICAgcG9zdCgnL3VwZGF0ZUJlZCcse2JlZF9uYW1lOiBuYW1lLCBiZWRfc29pbF9jaGFyYWN0ZXJpc3RpY3M6IHNvaWxDaGFyYWN0ZXJpc3RpY3MsIGJlZF90eXBlOiB0eXBlLCBiZWRfd2lkdGg6IHdpZHRoLCBiZWRfaGVpZ2h0OiBoZWlnaHQsIGJlZF9jb2xvdXI6IGZpbGx9KTtcbn1cblxuZnVuY3Rpb24gc2VuZFNhdmVQbGFudFJlcXVlc3QoKSB7XG4gICAgY29uc3QgdXBkYXRlUGxhbnRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtkYXRhLXVwZGF0ZS1wbGFudF0nKTtcbiAgICBjb25zdCBuYW1lID0gdXBkYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXBsYW50LW5hbWVdJykudmFsdWU7XG4gICAgY29uc3QgYmVkID0gdXBkYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXBsYW50LWJlZF0nKS52YWx1ZTtcbiAgICBjb25zdCB0eXBlID0gdXBkYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXBsYW50LXR5cGVdJykudmFsdWU7XG4gICAgY29uc3QgZGF0ZVBsYW50ZWQgPSB1cGRhdGVQbGFudEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtcGxhbnQtZGF0ZS1wbGFudGVkXScpLnZhbHVlO1xuICAgIGNvbnN0IGxhc3RDcm9wID0gdXBkYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXBsYW50LWxhc3QtY3JvcF0nKS52YWx1ZTtcbiAgICBjb25zdCBuZXh0Q3JvcCA9IHVwZGF0ZVBsYW50Rm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wbGFudC1uZXh0LWNyb3BdJykudmFsdWU7XG4gICAgY29uc3QgaWNvbiA9IHVwZGF0ZVBsYW50Rm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wbGFudC1pY29uXScpLnZhbHVlO1xuICAgIHBvc3QoJy91cGRhdGVQbGFudCcse3BsYW50X25hbWU6IG5hbWUsIHBsYW50X2JlZDogYmVkLCBwbGFudF90eXBlOiB0eXBlLCBwbGFudF9kYXRlX3BsYW50ZWQ6IGRhdGVQbGFudGVkLCBwbGFudF9sYXN0X2Nyb3A6IGxhc3RDcm9wLCBwbGFudF9uZXh0X2Nyb3A6IG5leHRDcm9wLCBwbGFudF9pY29uOiBpY29ufSk7XG59XG5cbmZ1bmN0aW9uIHNlbmREZWxldGVCZWRSZXF1ZXN0KCkge1xuICAgIGNvbnN0IHVwZGF0ZUJlZEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW2RhdGEtdXBkYXRlLWJlZF0nKTtcbiAgICBjb25zdCBuYW1lID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtbmFtZV0nKS52YWx1ZTtcbiAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmJlZHMgPSB3aW5kb3cucGxhbnRNYW5hZ2VyLmJlZHMuZmlsdGVyKG9iaiA9PiB7XG4gICAgICAgIHJldHVybiBvYmoubmFtZSAhPT0gbmFtZTtcbiAgICB9KTtcbiAgICBwb3N0KCcvZGVsZXRlQmVkJyx7YmVkX25hbWU6IG5hbWV9KTtcbn1cblxuZnVuY3Rpb24gc2VuZERlbGV0ZVBsYW50UmVxdWVzdCgpIHtcbiAgICBjb25zdCB1cGRhdGVQbGFudEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW2RhdGEtdXBkYXRlLXBsYW50XScpO1xuICAgIGNvbnN0IG5hbWUgPSB1cGRhdGVQbGFudEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtcGxhbnQtbmFtZV0nKS52YWx1ZTtcbiAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLnBsYW50cyA9IHdpbmRvdy5wbGFudE1hbmFnZXIucGxhbnRzLmZpbHRlcihvYmogPT4ge1xuICAgICAgICByZXR1cm4gb2JqLm5hbWUgIT09IG5hbWU7XG4gICAgfSk7XG4gICAgcG9zdCgnL2RlbGV0ZVBsYW50Jyx7cGxhbnRfbmFtZTogbmFtZX0pO1xufVxuXG5mdW5jdGlvbiBwb3N0KHBhdGgsIGRhdGEpIHtcbiAgICByZXR1cm4gd2luZG93LmZldGNoKHBhdGgsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldChwYXRoKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5mZXRjaChwYXRoLCB7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZSwgbm8tc3RvcmUsIG11c3QtcmV2YWxpZGF0ZScsXG4gICAgICAgICAgICAnUHJhZ21hJzogJ25vLWNhY2hlJyxcbiAgICAgICAgICAgICdFeHBpcmVzJzogMFxuICAgICAgICB9XG4gICAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIHNlbmRDcmVhdGVQbGFudFJlcXVlc3QsXG4gICAgc2VuZENyZWF0ZUJlZFJlcXVlc3QsXG4gICAgc2VuZFNhdmVBbGxCZWRQb3NpdGlvbnNSZXF1ZXN0LFxuICAgIHNlbmRTYXZlQWxsUGxhbnRQb3NpdGlvbnNSZXF1ZXN0LFxuICAgIHNlbmRTYXZlQmVkUmVxdWVzdCxcbiAgICBzZW5kU2F2ZVBsYW50UmVxdWVzdCxcbiAgICBzZW5kRGVsZXRlQmVkUmVxdWVzdCxcbiAgICBzZW5kRGVsZXRlUGxhbnRSZXF1ZXN0LFxuICAgIGdldCxcbiAgICBwb3N0XG59O1xuIl19"}