{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/app.js","src/http-requests.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const httpRequests = require('./http-requests');\n\n$('[data-plant-date-planted]').datepicker({format: 'yyyy/mm/dd'});\n\nfunction closeAllOverlays() {\n    const overlays = document.querySelectorAll('.overlay');\n    overlays.forEach(el => {el.classList.add('hidden')});\n}\n\nfunction retrieveBedFromWindowObject(name) {\n    const beds = window.plantManager.beds;\n    for (let i = 0; i < beds.length; i++) {\n        if (beds[i].name === name) {\n            return beds[i];\n        }\n    }\n\n}\n\nfunction createBedRectInWindow() {\n    const createBedForm = document.querySelector('form[data-create-bed]');\n    window.plantManager.beds.push({\n        name: createBedForm.querySelector('input[data-bed-name]').value,\n        x: 200,\n        y: 300,\n        width: createBedForm.querySelector('input[data-bed-width]').value,\n        height: createBedForm.querySelector('input[data-bed-height]').value,\n        fill: createBedForm.querySelector('input[data-bed-colour]').value,\n        soil_characteristics: createBedForm.querySelector('select[data-bed-soil-characteristics]').value,\n        bed_type: createBedForm.querySelector('select[data-bed-type]').value,\n        isDragging: false\n    });\n}\n\nfunction updateBedRectInWindow() {\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = updateBedForm.querySelector('[data-bed-name]').value;\n    const bed = retrieveBedFromWindowObject(name);\n    bed.name = name;\n    bed.width = parseInt(updateBedForm.querySelector('[data-bed-width]').value, 10);\n    bed.height = parseInt(updateBedForm.querySelector('[data-bed-height]').value, 10);\n    bed.fill = updateBedForm.querySelector('[data-bed-colour]').value;\n    bed.soilCharacteristics = updateBedForm.querySelector('[data-bed-soil-characteristics]').value;\n    bed.type = updateBedForm.querySelector('[data-bed-type]').value;\n}\n\nfunction populateBedDropdowns(bedObj) {\n    const name = bedObj.bed_name;\n    Array.prototype.slice.call(document.querySelectorAll('select[data-plant-bed]')).forEach(selectEl => {\n        const el = document.createElement('option');\n        el.setAttribute('value', name);\n        el.textContent = name;\n        selectEl.appendChild(el);\n    })\n}\n\ndocument.querySelector('form[data-create-plant]').addEventListener('submit', event => {\n    event.preventDefault();\n    httpRequests.sendCreatePlantRequest();\n    closeAllOverlays();\n});\n\ndocument.querySelector('form[data-create-bed]').addEventListener('submit', event => {\n    event.preventDefault();\n    httpRequests.sendCreateBedRequest();\n    createBedRectInWindow();\n    window.plantManager.drawAll();\n    closeAllOverlays();\n});\n\ndocument.querySelector('button[data-update-beds]').addEventListener('click', event => {\n    event.preventDefault();\n    httpRequests.sendSaveAllBedPositionsRequest();\n});\n\ndocument.querySelector('input[data-save-bed]').addEventListener('click', event => {\n    event.preventDefault();\n    updateBedRectInWindow();\n    httpRequests.sendSaveBedRequest();\n    window.plantManager.drawAll();\n});\n\ndocument.querySelector('input[data-delete-bed]').addEventListener('click', event => {\n    event.preventDefault();\n    httpRequests.sendDeleteBedRequest();\n    window.plantManager.drawAll();\n});\n\n[].slice.call(document.querySelectorAll('[data-open-overlay]')).forEach(button => {\n    const overlayName = button.dataset.openOverlay;\n    button.addEventListener('click', event => {\n        event.preventDefault();\n        document.querySelector(`div[data-${overlayName}-overlay]`).classList.remove('hidden');\n    });\n});\n\n[].slice.call(document.querySelectorAll('[data-close-overlay]')).forEach(button => {\n    const overlayName = button.dataset.closeOverlay;\n    button.addEventListener('click', event => {\n        event.preventDefault();\n        document.querySelector(`div[data-${overlayName}-overlay]`).classList.add('hidden');\n    });\n});\n\nfunction drawAnImage(fileName) {\n    const canvas = document.querySelector('canvas');\n    const ctx = canvas.getContext('2d');\n    const image = new Image();\n    image.src = `/${fileName}`;\n    image.onload = () => {\n        ctx.drawImage(image, 0, 0, 100, 100);\n    };\n    window.plantManager.plants.push({\n        name: fileName,\n        x: 0,\n        y: 0,\n        width: 100,\n        height: 100,\n        fill: 'rgba(255, 255, 255, 0.40)',\n        bed: null,\n        type: null,\n        datePlanted: null,\n        lastCrop: null,\n        nextCrop: null,\n        isDragging: false,\n        imageFileName: fileName\n    })\n}\n\nhttpRequests.get('/getBeds').then(response => {\n    response.json().then(data => {\n        let i = 1;\n        data.forEach(obj => {\n            window.plantManager.beds.push({\n                name: obj.bed_name,\n                x: obj.bed_x,\n                y: obj.bed_y,\n                width: obj.bed_width,\n                height: obj.bed_height,\n                fill: obj.bed_colour,\n                soil_characteristics: obj.bed_soil_characteristics,\n                bed_type: obj.bed_type,\n                isDragging: false,\n            });\n            if(i < 32) {\n                document.querySelector(`[data-table-name-${i}]`).setAttribute('value', obj.bed_name);\n                document.querySelector(`[data-table-type-${i}]`).setAttribute('value', obj.bed_type);\n                document.querySelector(`[data-table-soil-characteristics-${i}]`).setAttribute('value', obj.bed_soil_characteristics);\n                document.querySelector(`[data-table-name-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-table-type-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-table-soil-characteristics-${i}]`).dataset.empty = \"false\";\n                document.querySelector(`[data-tr-${i}]`).dataset.empty = \"false\";\n                i++;\n            }\n            populateBedDropdowns(obj);\n        });\n        window.plantManager.drawAll();\n        drawAnImage('onion.svg');\n        window.plantManager.drawAll();\n\n    });\n});\n","function sendCreatePlantRequest() {\n    const createPlantForm = document.querySelector('form[data-create-plant]');\n    const plant_name = createPlantForm.querySelector('input[data-plant-name]').value;\n    const date_planted = createPlantForm.querySelector('input[data-plant-date-planted]').value;\n    post('/createPlant', {plant_name, date_planted});\n}\n\nfunction sendCreateBedRequest() {\n    const createBedForm = document.querySelector('form[data-create-bed]');\n    const bed_name = createBedForm.querySelector('input[data-bed-name]').value;\n    const bed_soil_characteristics = createBedForm.querySelector('select[data-bed-soil-characteristics]').value;\n    const bed_type = createBedForm.querySelector('select[data-bed-type]').value;\n    const bed_width = createBedForm.querySelector('input[data-bed-width]').value;\n    const bed_height = createBedForm.querySelector('input[data-bed-height]').value;\n    const bed_colour = createBedForm.querySelector('input[data-bed-colour]').value;\n    const bed_x = 200;\n    const bed_y = 300;\n    post('/createBed', {bed_name, bed_soil_characteristics, bed_type, bed_width, bed_height, bed_colour, bed_x, bed_y});\n}\n\nfunction sendSaveAllBedPositionsRequest() {\n    const pm = window.plantManager;\n    for (let z = 0; z < pm.beds.length; z++) {\n        post('/updateBedPosition',{bed_name: pm.beds[z].name, bed_x: pm.beds[z].x, bed_y: pm.beds[z].y});\n    }\n}\n\nfunction sendSaveBedRequest() {\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = updateBedForm.querySelector('[data-bed-name]').value;\n    const width = updateBedForm.querySelector('[data-bed-width]').value;\n    const height = updateBedForm.querySelector('[data-bed-height]').value;\n    const fill = updateBedForm.querySelector('[data-bed-colour]').value;\n    const soilCharacteristics = updateBedForm.querySelector('[data-bed-soil-characteristics]').value;\n    const type = updateBedForm.querySelector('[data-bed-type]').value;\n    post('/updateBed',{bed_name: name, bed_soil_characteristics: soilCharacteristics, bed_type: type, bed_width: width, bed_height: height, bed_colour: fill});\n}\n\nfunction sendDeleteBedRequest() {\n    const updateBedForm = document.querySelector('form[data-update-bed]');\n    const name = updateBedForm.querySelector('[data-bed-name]').value;\n    window.plantManager.rectangles = window.plantManager.rectangles.filter(obj => {\n        return obj.name !== name;\n    });\n    post('/deleteBed',{bed_name: name});\n}\n\nfunction post(path, data) {\n    return window.fetch(path, {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(data)\n    });\n}\n\nfunction get(path) {\n    return window.fetch(path, {\n        method: 'GET',\n        headers: {\n            'Accept': 'application/json',\n            'Cache-Control': 'no-cache, no-store, must-revalidate',\n            'Pragma': 'no-cache',\n            'Expires': 0\n        }\n    });\n}\n\nmodule.exports = {\n    sendCreatePlantRequest,\n    sendCreateBedRequest,\n    sendSaveAllBedPositionsRequest,\n    sendSaveBedRequest,\n    sendDeleteBedRequest,\n    get,\n    post\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIiwic3JjL2h0dHAtcmVxdWVzdHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGh0dHBSZXF1ZXN0cyA9IHJlcXVpcmUoJy4vaHR0cC1yZXF1ZXN0cycpO1xuXG4kKCdbZGF0YS1wbGFudC1kYXRlLXBsYW50ZWRdJykuZGF0ZXBpY2tlcih7Zm9ybWF0OiAneXl5eS9tbS9kZCd9KTtcblxuZnVuY3Rpb24gY2xvc2VBbGxPdmVybGF5cygpIHtcbiAgICBjb25zdCBvdmVybGF5cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vdmVybGF5Jyk7XG4gICAgb3ZlcmxheXMuZm9yRWFjaChlbCA9PiB7ZWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyl9KTtcbn1cblxuZnVuY3Rpb24gcmV0cmlldmVCZWRGcm9tV2luZG93T2JqZWN0KG5hbWUpIHtcbiAgICBjb25zdCBiZWRzID0gd2luZG93LnBsYW50TWFuYWdlci5iZWRzO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmVkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoYmVkc1tpXS5uYW1lID09PSBuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gYmVkc1tpXTtcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5mdW5jdGlvbiBjcmVhdGVCZWRSZWN0SW5XaW5kb3coKSB7XG4gICAgY29uc3QgY3JlYXRlQmVkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS1jcmVhdGUtYmVkXScpO1xuICAgIHdpbmRvdy5wbGFudE1hbmFnZXIuYmVkcy5wdXNoKHtcbiAgICAgICAgbmFtZTogY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWJlZC1uYW1lXScpLnZhbHVlLFxuICAgICAgICB4OiAyMDAsXG4gICAgICAgIHk6IDMwMCxcbiAgICAgICAgd2lkdGg6IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1iZWQtd2lkdGhdJykudmFsdWUsXG4gICAgICAgIGhlaWdodDogY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWJlZC1oZWlnaHRdJykudmFsdWUsXG4gICAgICAgIGZpbGw6IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS1iZWQtY29sb3VyXScpLnZhbHVlLFxuICAgICAgICBzb2lsX2NoYXJhY3RlcmlzdGljczogY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdzZWxlY3RbZGF0YS1iZWQtc29pbC1jaGFyYWN0ZXJpc3RpY3NdJykudmFsdWUsXG4gICAgICAgIGJlZF90eXBlOiBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ3NlbGVjdFtkYXRhLWJlZC10eXBlXScpLnZhbHVlLFxuICAgICAgICBpc0RyYWdnaW5nOiBmYWxzZVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVCZWRSZWN0SW5XaW5kb3coKSB7XG4gICAgY29uc3QgdXBkYXRlQmVkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS11cGRhdGUtYmVkXScpO1xuICAgIGNvbnN0IG5hbWUgPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1uYW1lXScpLnZhbHVlO1xuICAgIGNvbnN0IGJlZCA9IHJldHJpZXZlQmVkRnJvbVdpbmRvd09iamVjdChuYW1lKTtcbiAgICBiZWQubmFtZSA9IG5hbWU7XG4gICAgYmVkLndpZHRoID0gcGFyc2VJbnQodXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtd2lkdGhdJykudmFsdWUsIDEwKTtcbiAgICBiZWQuaGVpZ2h0ID0gcGFyc2VJbnQodXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtaGVpZ2h0XScpLnZhbHVlLCAxMCk7XG4gICAgYmVkLmZpbGwgPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1jb2xvdXJdJykudmFsdWU7XG4gICAgYmVkLnNvaWxDaGFyYWN0ZXJpc3RpY3MgPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1zb2lsLWNoYXJhY3RlcmlzdGljc10nKS52YWx1ZTtcbiAgICBiZWQudHlwZSA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLXR5cGVdJykudmFsdWU7XG59XG5cbmZ1bmN0aW9uIHBvcHVsYXRlQmVkRHJvcGRvd25zKGJlZE9iaikge1xuICAgIGNvbnN0IG5hbWUgPSBiZWRPYmouYmVkX25hbWU7XG4gICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnc2VsZWN0W2RhdGEtcGxhbnQtYmVkXScpKS5mb3JFYWNoKHNlbGVjdEVsID0+IHtcbiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd2YWx1ZScsIG5hbWUpO1xuICAgICAgICBlbC50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgICAgIHNlbGVjdEVsLmFwcGVuZENoaWxkKGVsKTtcbiAgICB9KVxufVxuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW2RhdGEtY3JlYXRlLXBsYW50XScpLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGV2ZW50ID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGh0dHBSZXF1ZXN0cy5zZW5kQ3JlYXRlUGxhbnRSZXF1ZXN0KCk7XG4gICAgY2xvc2VBbGxPdmVybGF5cygpO1xufSk7XG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS1jcmVhdGUtYmVkXScpLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGV2ZW50ID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGh0dHBSZXF1ZXN0cy5zZW5kQ3JlYXRlQmVkUmVxdWVzdCgpO1xuICAgIGNyZWF0ZUJlZFJlY3RJbldpbmRvdygpO1xuICAgIHdpbmRvdy5wbGFudE1hbmFnZXIuZHJhd0FsbCgpO1xuICAgIGNsb3NlQWxsT3ZlcmxheXMoKTtcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdidXR0b25bZGF0YS11cGRhdGUtYmVkc10nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGh0dHBSZXF1ZXN0cy5zZW5kU2F2ZUFsbEJlZFBvc2l0aW9uc1JlcXVlc3QoKTtcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLXNhdmUtYmVkXScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdXBkYXRlQmVkUmVjdEluV2luZG93KCk7XG4gICAgaHR0cFJlcXVlc3RzLnNlbmRTYXZlQmVkUmVxdWVzdCgpO1xuICAgIHdpbmRvdy5wbGFudE1hbmFnZXIuZHJhd0FsbCgpO1xufSk7XG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtZGVsZXRlLWJlZF0nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGh0dHBSZXF1ZXN0cy5zZW5kRGVsZXRlQmVkUmVxdWVzdCgpO1xuICAgIHdpbmRvdy5wbGFudE1hbmFnZXIuZHJhd0FsbCgpO1xufSk7XG5cbltdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtb3Blbi1vdmVybGF5XScpKS5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheU5hbWUgPSBidXR0b24uZGF0YXNldC5vcGVuT3ZlcmxheTtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdltkYXRhLSR7b3ZlcmxheU5hbWV9LW92ZXJsYXldYCkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgfSk7XG59KTtcblxuW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jbG9zZS1vdmVybGF5XScpKS5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheU5hbWUgPSBidXR0b24uZGF0YXNldC5jbG9zZU92ZXJsYXk7XG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBkaXZbZGF0YS0ke292ZXJsYXlOYW1lfS1vdmVybGF5XWApLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgIH0pO1xufSk7XG5cbmZ1bmN0aW9uIGRyYXdBbkltYWdlKGZpbGVOYW1lKSB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FudmFzJyk7XG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWFnZS5zcmMgPSBgLyR7ZmlsZU5hbWV9YDtcbiAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIDEwMCwgMTAwKTtcbiAgICB9O1xuICAgIHdpbmRvdy5wbGFudE1hbmFnZXIucGxhbnRzLnB1c2goe1xuICAgICAgICBuYW1lOiBmaWxlTmFtZSxcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMCxcbiAgICAgICAgd2lkdGg6IDEwMCxcbiAgICAgICAgaGVpZ2h0OiAxMDAsXG4gICAgICAgIGZpbGw6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNDApJyxcbiAgICAgICAgYmVkOiBudWxsLFxuICAgICAgICB0eXBlOiBudWxsLFxuICAgICAgICBkYXRlUGxhbnRlZDogbnVsbCxcbiAgICAgICAgbGFzdENyb3A6IG51bGwsXG4gICAgICAgIG5leHRDcm9wOiBudWxsLFxuICAgICAgICBpc0RyYWdnaW5nOiBmYWxzZSxcbiAgICAgICAgaW1hZ2VGaWxlTmFtZTogZmlsZU5hbWVcbiAgICB9KVxufVxuXG5odHRwUmVxdWVzdHMuZ2V0KCcvZ2V0QmVkcycpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICBsZXQgaSA9IDE7XG4gICAgICAgIGRhdGEuZm9yRWFjaChvYmogPT4ge1xuICAgICAgICAgICAgd2luZG93LnBsYW50TWFuYWdlci5iZWRzLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6IG9iai5iZWRfbmFtZSxcbiAgICAgICAgICAgICAgICB4OiBvYmouYmVkX3gsXG4gICAgICAgICAgICAgICAgeTogb2JqLmJlZF95LFxuICAgICAgICAgICAgICAgIHdpZHRoOiBvYmouYmVkX3dpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogb2JqLmJlZF9oZWlnaHQsXG4gICAgICAgICAgICAgICAgZmlsbDogb2JqLmJlZF9jb2xvdXIsXG4gICAgICAgICAgICAgICAgc29pbF9jaGFyYWN0ZXJpc3RpY3M6IG9iai5iZWRfc29pbF9jaGFyYWN0ZXJpc3RpY3MsXG4gICAgICAgICAgICAgICAgYmVkX3R5cGU6IG9iai5iZWRfdHlwZSxcbiAgICAgICAgICAgICAgICBpc0RyYWdnaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYoaSA8IDMyKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdGFibGUtbmFtZS0ke2l9XWApLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBvYmouYmVkX25hbWUpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRhYmxlLXR5cGUtJHtpfV1gKS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb2JqLmJlZF90eXBlKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS1zb2lsLWNoYXJhY3RlcmlzdGljcy0ke2l9XWApLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBvYmouYmVkX3NvaWxfY2hhcmFjdGVyaXN0aWNzKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS1uYW1lLSR7aX1dYCkuZGF0YXNldC5lbXB0eSA9IFwiZmFsc2VcIjtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS10eXBlLSR7aX1dYCkuZGF0YXNldC5lbXB0eSA9IFwiZmFsc2VcIjtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10YWJsZS1zb2lsLWNoYXJhY3RlcmlzdGljcy0ke2l9XWApLmRhdGFzZXQuZW1wdHkgPSBcImZhbHNlXCI7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdHItJHtpfV1gKS5kYXRhc2V0LmVtcHR5ID0gXCJmYWxzZVwiO1xuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvcHVsYXRlQmVkRHJvcGRvd25zKG9iaik7XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmRyYXdBbGwoKTtcbiAgICAgICAgZHJhd0FuSW1hZ2UoJ29uaW9uLnN2ZycpO1xuICAgICAgICB3aW5kb3cucGxhbnRNYW5hZ2VyLmRyYXdBbGwoKTtcblxuICAgIH0pO1xufSk7XG4iLCJmdW5jdGlvbiBzZW5kQ3JlYXRlUGxhbnRSZXF1ZXN0KCkge1xuICAgIGNvbnN0IGNyZWF0ZVBsYW50Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS1jcmVhdGUtcGxhbnRdJyk7XG4gICAgY29uc3QgcGxhbnRfbmFtZSA9IGNyZWF0ZVBsYW50Rm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLXBsYW50LW5hbWVdJykudmFsdWU7XG4gICAgY29uc3QgZGF0ZV9wbGFudGVkID0gY3JlYXRlUGxhbnRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtcGxhbnQtZGF0ZS1wbGFudGVkXScpLnZhbHVlO1xuICAgIHBvc3QoJy9jcmVhdGVQbGFudCcsIHtwbGFudF9uYW1lLCBkYXRlX3BsYW50ZWR9KTtcbn1cblxuZnVuY3Rpb24gc2VuZENyZWF0ZUJlZFJlcXVlc3QoKSB7XG4gICAgY29uc3QgY3JlYXRlQmVkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bZGF0YS1jcmVhdGUtYmVkXScpO1xuICAgIGNvbnN0IGJlZF9uYW1lID0gY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWJlZC1uYW1lXScpLnZhbHVlO1xuICAgIGNvbnN0IGJlZF9zb2lsX2NoYXJhY3RlcmlzdGljcyA9IGNyZWF0ZUJlZEZvcm0ucXVlcnlTZWxlY3Rvcignc2VsZWN0W2RhdGEtYmVkLXNvaWwtY2hhcmFjdGVyaXN0aWNzXScpLnZhbHVlO1xuICAgIGNvbnN0IGJlZF90eXBlID0gY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdzZWxlY3RbZGF0YS1iZWQtdHlwZV0nKS52YWx1ZTtcbiAgICBjb25zdCBiZWRfd2lkdGggPSBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtYmVkLXdpZHRoXScpLnZhbHVlO1xuICAgIGNvbnN0IGJlZF9oZWlnaHQgPSBjcmVhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2RhdGEtYmVkLWhlaWdodF0nKS52YWx1ZTtcbiAgICBjb25zdCBiZWRfY29sb3VyID0gY3JlYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLWJlZC1jb2xvdXJdJykudmFsdWU7XG4gICAgY29uc3QgYmVkX3ggPSAyMDA7XG4gICAgY29uc3QgYmVkX3kgPSAzMDA7XG4gICAgcG9zdCgnL2NyZWF0ZUJlZCcsIHtiZWRfbmFtZSwgYmVkX3NvaWxfY2hhcmFjdGVyaXN0aWNzLCBiZWRfdHlwZSwgYmVkX3dpZHRoLCBiZWRfaGVpZ2h0LCBiZWRfY29sb3VyLCBiZWRfeCwgYmVkX3l9KTtcbn1cblxuZnVuY3Rpb24gc2VuZFNhdmVBbGxCZWRQb3NpdGlvbnNSZXF1ZXN0KCkge1xuICAgIGNvbnN0IHBtID0gd2luZG93LnBsYW50TWFuYWdlcjtcbiAgICBmb3IgKGxldCB6ID0gMDsgeiA8IHBtLmJlZHMubGVuZ3RoOyB6KyspIHtcbiAgICAgICAgcG9zdCgnL3VwZGF0ZUJlZFBvc2l0aW9uJyx7YmVkX25hbWU6IHBtLmJlZHNbel0ubmFtZSwgYmVkX3g6IHBtLmJlZHNbel0ueCwgYmVkX3k6IHBtLmJlZHNbel0ueX0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc2VuZFNhdmVCZWRSZXF1ZXN0KCkge1xuICAgIGNvbnN0IHVwZGF0ZUJlZEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW2RhdGEtdXBkYXRlLWJlZF0nKTtcbiAgICBjb25zdCBuYW1lID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtbmFtZV0nKS52YWx1ZTtcbiAgICBjb25zdCB3aWR0aCA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLXdpZHRoXScpLnZhbHVlO1xuICAgIGNvbnN0IGhlaWdodCA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLWhlaWdodF0nKS52YWx1ZTtcbiAgICBjb25zdCBmaWxsID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtY29sb3VyXScpLnZhbHVlO1xuICAgIGNvbnN0IHNvaWxDaGFyYWN0ZXJpc3RpY3MgPSB1cGRhdGVCZWRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJlZC1zb2lsLWNoYXJhY3RlcmlzdGljc10nKS52YWx1ZTtcbiAgICBjb25zdCB0eXBlID0gdXBkYXRlQmVkRm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iZWQtdHlwZV0nKS52YWx1ZTtcbiAgICBwb3N0KCcvdXBkYXRlQmVkJyx7YmVkX25hbWU6IG5hbWUsIGJlZF9zb2lsX2NoYXJhY3RlcmlzdGljczogc29pbENoYXJhY3RlcmlzdGljcywgYmVkX3R5cGU6IHR5cGUsIGJlZF93aWR0aDogd2lkdGgsIGJlZF9oZWlnaHQ6IGhlaWdodCwgYmVkX2NvbG91cjogZmlsbH0pO1xufVxuXG5mdW5jdGlvbiBzZW5kRGVsZXRlQmVkUmVxdWVzdCgpIHtcbiAgICBjb25zdCB1cGRhdGVCZWRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtkYXRhLXVwZGF0ZS1iZWRdJyk7XG4gICAgY29uc3QgbmFtZSA9IHVwZGF0ZUJlZEZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtYmVkLW5hbWVdJykudmFsdWU7XG4gICAgd2luZG93LnBsYW50TWFuYWdlci5yZWN0YW5nbGVzID0gd2luZG93LnBsYW50TWFuYWdlci5yZWN0YW5nbGVzLmZpbHRlcihvYmogPT4ge1xuICAgICAgICByZXR1cm4gb2JqLm5hbWUgIT09IG5hbWU7XG4gICAgfSk7XG4gICAgcG9zdCgnL2RlbGV0ZUJlZCcse2JlZF9uYW1lOiBuYW1lfSk7XG59XG5cbmZ1bmN0aW9uIHBvc3QocGF0aCwgZGF0YSkge1xuICAgIHJldHVybiB3aW5kb3cuZmV0Y2gocGF0aCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSlcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0KHBhdGgpIHtcbiAgICByZXR1cm4gd2luZG93LmZldGNoKHBhdGgsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLWNhY2hlLCBuby1zdG9yZSwgbXVzdC1yZXZhbGlkYXRlJyxcbiAgICAgICAgICAgICdQcmFnbWEnOiAnbm8tY2FjaGUnLFxuICAgICAgICAgICAgJ0V4cGlyZXMnOiAwXG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgc2VuZENyZWF0ZVBsYW50UmVxdWVzdCxcbiAgICBzZW5kQ3JlYXRlQmVkUmVxdWVzdCxcbiAgICBzZW5kU2F2ZUFsbEJlZFBvc2l0aW9uc1JlcXVlc3QsXG4gICAgc2VuZFNhdmVCZWRSZXF1ZXN0LFxuICAgIHNlbmREZWxldGVCZWRSZXF1ZXN0LFxuICAgIGdldCxcbiAgICBwb3N0XG59O1xuIl19"}